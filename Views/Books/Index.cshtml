@model IEnumerable<WebAss2.Models.Book>

@{  
    ViewBag.Title = "Book Library";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <h1 class="display-4 mb-4">Book Library</h1>
            <p class="lead">Browse our collection of books.</p>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Search & Filter</h5>
                </div>
                <div class="card-body">
                    @using (Html.BeginForm("Index", "Books", FormMethod.Get, new { @class = "d-flex flex-wrap gap-3 align-items-end" }))
                    {
                        <div class="flex-grow-1" style="min-width: 300px;">
                            <label for="searchString" class="form-label">Search:</label>
                            @Html.TextBox("searchString", ViewBag.SearchString as string, new { @class = "form-control w-100", placeholder = "Title, Author..." })
                        </div>

                        <div style="min-width: 200px;">
                            <label for="category" class="form-label">Category:</label>
                            @Html.DropDownList("category", new SelectList(ViewBag.Categories), "All Categories", new { @class = "form-control w-100" })
                        </div>

                        <div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search me-2"></i> Search
                            </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Sorting Options -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm bg-light">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-start gap-2">
                        <h6 class="mb-0">Sort by:</h6>
                        
                        <!-- Title Sort -->
                        <div class="btn-group">
                            <a href="@Url.Action("Index", new {
                                searchString = ViewBag.SearchString,
                                category = ViewBag.SelectedCategory,
                                sortOrder = ""
                            })
                               class="btn @(string.IsNullOrEmpty(ViewBag.CurrentSort) ? "btn-primary" : "btn-outline-primary")">
                                Title
                            </a>
                            <a href="@Url.Action("Index", new {
                                searchString = ViewBag.SearchString,
                                category = ViewBag.SelectedCategory,
                                sortOrder = "title_desc"
                            })
                               class="btn @(ViewBag.CurrentSort == "title_desc" ? "btn-primary" : "btn-outline-primary")">
                                <i class="fas fa-sort-down"></i>
                            </a>
                        </div>
                        
                        <!-- Author Sort -->
                        <div class="btn-group">
                            <a href="@Url.Action("Index", new {
                                searchString = ViewBag.SearchString,
                                category = ViewBag.SelectedCategory,
                                sortOrder = "author_asc"
                            })
                               class="btn @(ViewBag.CurrentSort == "author_asc" ? "btn-primary" : "btn-outline-primary")">
                                Author
                            </a>
                            <a href="@Url.Action("Index", new {
                                searchString = ViewBag.SearchString,
                                category = ViewBag.SelectedCategory,
                                sortOrder = "author_desc"
                            })
                               class="btn @(ViewBag.CurrentSort == "author_desc" ? "btn-primary" : "btn-outline-primary")">
                                <i class="fas fa-sort-down"></i>
                            </a>
                        </div>
                        
                        <!-- Price Sort -->
                        <div class="btn-group">
                            <a href="@Url.Action("Index", new {
                                searchString = ViewBag.SearchString,
                                category = ViewBag.SelectedCategory,
                                sortOrder = "price_asc"
                            })
                               class="btn @(ViewBag.CurrentSort == "price_asc" ? "btn-primary" : "btn-outline-primary")">
                                Price
                            </a>
                            <a href="@Url.Action("Index", new {
                                searchString = ViewBag.SearchString,
                                category = ViewBag.SelectedCategory,
                                sortOrder = "price_desc"
                            })
                               class="btn @(ViewBag.CurrentSort == "price_desc" ? "btn-primary" : "btn-outline-primary")">
                                <i class="fas fa-sort-down"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Books Grid -->
    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-md-4 mb-4">
                <div class="card h-100 book-card shadow-sm">
                    <!-- Book Cover Image -->
                    <img src="https://picsum.photos/id/@(item.Id + 10)/300/400" class="card-img-top" alt="@Html.DisplayFor(modelItem => item.Title) cover">
                    
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">@Html.DisplayFor(modelItem => item.Title)</h5>
                        <small class="text-muted">by @Html.DisplayFor(modelItem => item.Author)</small>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            <strong>Category:</strong> <span class="badge bg-secondary">@Html.DisplayFor(modelItem => item.Category.Name)</span>
                        </p>
                        <p class="card-text">
                            <strong>Published:</strong> @Html.DisplayFor(modelItem => item.PublishedYear)
                        </p>
                        <p class="card-text">
                            <strong>Price:</strong> <span class="text-success fw-bold">@Html.DisplayFor(modelItem => item.Price)</span>
                        </p>
                        @if (item.Rating.HasValue)
                        {
                            <p class="card-text">
                                <strong>Rating:</strong>
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= Math.Floor(item.Rating.Value))
                                    {
                                        <i class="fas fa-star text-warning"></i>
                                    }
                                    else
                                    {
                                        <i class="far fa-star text-warning"></i>
                                    }
                                }
                            </p>
                        }
                        <p class="card-text text-truncate">@Html.DisplayFor(modelItem => item.Description)</p>
                    </div>
                    <div class="card-footer bg-transparent">
                        <div class="btn-group w-100" role="group">
                            @Html.ActionLink("Details", "Details", new { id = item.Id }, new { @class = "btn btn-outline-primary btn-sm" })
                            @Html.ActionLink("Edit", "Edit", new { id = item.Id }, new { @class = "btn btn-outline-secondary btn-sm" })
                            @Html.ActionLink("Delete", "Delete", new { id = item.Id }, new { @class = "btn btn-outline-danger btn-sm delete-link" })
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Pagination -->
    @if (ViewBag.TotalPages > 1)
    {
        <div class="row mt-4">
            <div class="col-md-12">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        @if (ViewBag.PageNumber > 1)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { page = 1, searchString = ViewBag.SearchString, category = ViewBag.SelectedCategory, sortOrder = ViewBag.CurrentSort })" aria-label="First">
                                    <span aria-hidden="true">&laquo;&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.PageNumber - 1, searchString = ViewBag.SearchString, category = ViewBag.SelectedCategory, sortOrder = ViewBag.CurrentSort })" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                        }

                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                        {
                            <li class="page-item @(i == ViewBag.PageNumber ? "active" : "")">
                                <a class="page-link" href="@Url.Action("Index", new { page = i, searchString = ViewBag.SearchString, category = ViewBag.SelectedCategory, sortOrder = ViewBag.CurrentSort })">@i</a>
                            </li>
                        }

                        @if (ViewBag.PageNumber < ViewBag.TotalPages)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.PageNumber + 1, searchString = ViewBag.SearchString, category = ViewBag.SelectedCategory, sortOrder = ViewBag.CurrentSort })" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.TotalPages, searchString = ViewBag.SearchString, category = ViewBag.SelectedCategory, sortOrder = ViewBag.CurrentSort })" aria-label="Last">
                                    <span aria-hidden="true">&raquo;&raquo;</span>
                                </a>
                            </li>
                        }
                    </ul>
                </nav>
                <p class="text-center text-muted">
                    Showing page @ViewBag.PageNumber of @ViewBag.TotalPages (@ViewBag.TotalItems books total)
                </p>
            </div>
        </div>
    }

    <!-- Add New Book Button -->
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            @Html.ActionLink("Add New Book", "Create", new { }, new { @class = "btn btn-primary btn-lg" })
        </div>
    </div>
</div>
